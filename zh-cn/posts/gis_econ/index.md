# ArcGispro 操作简要


> 空间分析与技术方法（简单实操）笔记。
## 空间计量

### 空间关系

什么是区域经济学，核心是利用**空间数据**刻画**空间关系**。空间数据需要数据和位置。**位置**不只是经纬度，还有距离。**距离**不只是空间距离，文化相似度也可以看作一种距离，关系程度（省份 gdp 排名，同伴亲密关系）。定义**位置关系**的方式也多种多样，例如点相邻，边相邻...

### 为什么需要空间计量

推荐参考《[空间计量经济学导论](https://zh.z-library.ec/book/16726690/efe0c9/%E7%A9%BA%E9%97%B4%E8%AE%A1%E9%87%8F%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%AF%BC%E8%AE%BA.html?ts=1509)》（James LeSage / R.Kelley Pac）

- **空间依赖**：不同观测点的值互相影响。
	- **竞争、合作、模仿、扩散（空间溢出性）、对抗**...... 
	- 这种内生性可能是 a 地 x 影响了 b 地的 y；也可能是 a 地的 y 直接影响了 b 地的 y。
- **空间自相关**：对空间依赖的一种测度。
	- **空间异质性**：空间依赖关系并不均匀分布。例如国内数据，可能东北是内部多地负相关，西南地区内部多地正相关关。
	- 测量也分为全局自相关和局部自相关。

因此，不同的空间自相关需要用不同的模型进行估计。


## 软件版本

- R、stata、matlab 各自有合适的空间计量包。
- [Geoda](https://geodacenter.github.io/zh-Hans/) 为免费开源的空间计量软件。
- **重点为 gis 软件**：如果选择 [arcgis](https://www.arcgis.com/index.html) 系列，其分为旧系列和 pro 系列。
- Arcgispro 是 arcgis 的升级版，但尚在迭代中，不稳定，**理论上 pro 都能兼容旧版**。由于国家需要版本稳定性，测绘的行业一般要求使用 `arcgis 10.2 版本` 或者 `arcgis 10.8 版本` 。网上大部分教程也是针对 arcgis 旧版的教程。

个人是经济学专业，并非专业测绘，所谓学新不学旧，因此选择 arcgispro。官方帮助教材可以参考[官网网站](https://pro.arcgis.com/zh-cn/pro-app/latest/get-started/get-started.htm)。

> 个人以前也使用过旧版，记录过的步骤为[转化 tif 为 excel](https://blog.huaxiangshan.com/zh-cn/posts/gis/)。个人感觉 pro 版本的页面更简介美观一些。

## 操作

### 基础设定

学习 stata 要培养良好的代码文件管理习惯，例如从 do 文件入手，而 gis 也是从**新建目录**开始。新建的目录就是自己的工程项目。

![如图](/img/Gispro操作简要.zh-cn-1762174389527.webp)

这里我新建了一个地图（`插入` - `新建地图`），目前是线上的默认全球地图。随意点击地图，正式开始工程。如果不满意页面布局，拖动几个选项框就可以换位置。

可以看到**右侧边缘**有：

- 目录：插入界面的 `添加文件夹`，可以把其他文件夹添加到目录内。后续在目录文件夹中新建处理图层。如果你有地图数据（`.geodatabase` 文件），也可以通过插入界面的 `连接` 把地图文件加载到目录的数据库中。
- 地理处理：主要的分析工具。
- 属性：数据属性，因为数据可能是边界轮廓、点面数据。
- 历史：操作历史

![左侧是地图的内容，主要是图层显示管理 ，右侧是目录、工具栏](/img/Gispro操作简要.zh-cn-1762175832065.webp)

![如图](/img/Gispro操作简要.zh-cn-1764340185120.webp)

整个文件目录的环境，本质上是电脑文件夹，新建 `.gdb` 其实是 gis 工程的文件夹。`.gdb` 下面又可以新建要素数据集。然后要素数据集下面就是存放的 gis 数据。例如图中的就是 `ex22-网络分析-网络-下面一堆数据集文件`。

每次创建新环境就是创建 `.gdb`，然后再在下面创建一个数据库，然后再导入我们要用的数据。

### 缓冲区分析（buffer）

所谓缓冲区就是围绕边界或者点圈定范围。

> 《**立“竿”见影：策略性环境规制与环境质量结构性改善**》（2024，*经济学季刊*（中文））就利用了 buffer 的策略。
> 
> 研究发现监测站设立后，距监测站4km范围内的PM2.5浓度降低幅度比4-8km区域多0.74%，表明监测站周围的环境质量呈现结构性改善（当地故意在检测站附近喷水美化考核指标）。其缓冲区分析就是**通过 gis 软件识别了每个检测站周围 4km 的区域范围**。


右键右侧侧边栏 `目录` 页面下我们添加的文件夹。

1. 右键新建 `移动地理数据库`。
2. 右键新建的 `移动地理数据库`
3. 新建 `要素类`：其中选择点数据类型，其他跟着提示走即可。
4. 可以发现左侧内容栏已经有了新建的点数据。

这时候继续点击 `编辑` - `创建`，然后随便点击页面就可以创建点位。同理，按照前面的步骤创建 `面要素类`，对应的编辑就是创建不同的面数据。

![编辑自建点数据，同理也可以自建面数据](/img/Gispro操作简要.zh-cn-1762177414904.webp) 

此时点击 `地理处理工具栏`（工具箱形式图标），然后按照提示选择即可。例如这里我就针对点数据进行缓冲分析，要求其划定每个点 100000 米范围的区域，结果如图所示。缓冲自然也可以针对线数据。

![缓冲区分析结果](/img/Gispro操作简要.zh-cn-1762176623535.webp)

### 邻接分析（proximity）

进一步，这里使用的工具为生成邻近表。

例如这里输入和邻近都是同一个点数据集，含义为**离自己最近的点数据是哪个**？

输出表格数据后右键打开即可。如果想要形象比较，右键 `内容` - `点文件` - `标注` 就是添加标签的操作。情况如下，例如第一个点距离最近的是第二个点。

邻接分析可以分析点、线、面之间的相邻关系。

![分析距离最近的点数据](/img/Gispro操作简要.zh-cn-1762178817771.webp)

邻接表只会默认把 FID 进行连接，想要添加名称标签就右键输出的邻接结果表然后 `添加和关联`。

![如图](/img/Gispro操作简要.zh-cn-1762181791273.webp)

### 栅格数据

Gis 有矢量、栅格、图像数据。实际上遥感图像也是栅格数据，通过网格进行划分填色，例如手机照片像素点概念。

不同的矢量转栅格插值方法不同，结果也不同。例如区域经济学中刻画**城市形态**其实是很困难的地方，**例如城市中间有大山大河？此时如何插值？**

![如图,这是一个人口密度的点集矢量数据](/img/Gispro操作简要.zh-cn-1763129086988.webp)



可以通过 `要素转栅格` 命令转化。典型的均匀涂色到对应的方格子之中。

![直接对点数据转栅格](/img/Gispro操作简要.zh-cn-1763129127588.webp)

使用插值进行填充，这里使用 `插值` 中的**反距离权重法**。

![反距离权重法对点数据进行插值](/img/Gispro操作简要.zh-cn-1763129200989.webp)

使用 `密度` 进行计算，这里使用 `核密度` 估计。

![核密度](/img/Gispro操作简要.zh-cn-1763129405819.webp)

此外，通过 `表面-等值线` 还可以插入等高线。

![等高线和核密度](/img/Gispro操作简要.zh-cn-1763129520527.webp)

如果想要修改分组层次，右键图层点击`符号系统`即可修改。

![符号系统可以修改分组层次](/img/Gispro操作简要.zh-cn-1763129597060.webp)

例如在城市规划中，我们有了城市用地规划、人口密度、学校分布、道路交通的矢量密度图。接下来思考新学校修建在哪里？我们可以使用 `地图代数-栅格计算器` 叠加计算每个栅格数据的值。

![如图](/img/Gispro操作简要.zh-cn-1763129832685.webp)

例如这里人口流量大，加五分，这里是山地，减少五分，这里有学校覆盖了，减少五分，最终得到新建学校的栅格分数。

![我随意选了些栅格做了地图几何运算，灰黑色部分就是几个栅格信息都最终计算结果。](/img/Gispro操作简要.zh-cn-1763129840413.webp)
### 网络分析




