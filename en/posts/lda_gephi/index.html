<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>LDA Topic Modeling and Gephi Visualization - 滑翔闪&#39;S BLOG</title><meta name="Description" content="This is my cool site"><meta property="og:title" content="LDA Topic Modeling and Gephi Visualization" />
<meta property="og:description" content="Young one, do you yearn for the power of network analysis?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.huaxiangshan.com/en/posts/lda_gephi/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2025-08-31T07:00:19+08:00" />
<meta property="article:modified_time" content="2025-08-31T07:00:19+08:00" /><meta property="og:site_name" content="My cool site" />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="LDA Topic Modeling and Gephi Visualization"/>
<meta name="twitter:description" content="Young one, do you yearn for the power of network analysis?"/>
<meta name="twitter:site" content="@ygVNLSZ1omFBCeB"/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://blog.huaxiangshan.com/en/posts/lda_gephi/" /><link rel="prev" href="https://blog.huaxiangshan.com/en/posts/sgns/" /><link rel="next" href="https://blog.huaxiangshan.com/en/posts/gzhs/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "LDA Topic Modeling and Gephi Visualization",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/blog.huaxiangshan.com\/en\/posts\/lda_gephi\/"
        },"genre": "posts","keywords": "Gephi, Python, Network","wordcount":  4876 ,
        "url": "https:\/\/blog.huaxiangshan.com\/en\/posts\/lda_gephi\/","datePublished": "2025-08-31T07:00:19+08:00","dateModified": "2025-08-31T07:00:19+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "滑翔闪"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper">












<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sakana 小组件集成</title>
  <style>
     
    #sakana-widget-container {
      position: fixed;
      bottom: 10px;
      left: 10px;
      width: 268px;
      height: 268px;
    }
    #sakana-widget {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="sakana-widget-container">
    <div id="sakana-widget"></div>
  </div>

  <script>
    function initSakanaWidget() {
      new SakanaWidget({
        size: 300,
        autoFit: true,
        character: 'chisato',
        controls: true,
        rod: true,
        draggable: true,
        stroke: { color: '#b4b4b4', width: 10 },
        threshold: 0.1,
        rotate: 0,
        title: false
      }).mount('#sakana-widget');

      
      checkScreenWidth();
      window.addEventListener('resize', checkScreenWidth);
    }

    function checkScreenWidth() {
      var screenWidth = window.innerWidth;
      var container = document.getElementById('sakana-widget-container');
      if (screenWidth <= 960) {
        container.style.display = 'none';
      } else {
        container.style.display = 'block';
      }
    }
  </script>

  
  <script 
    async
    onload="initSakanaWidget()"
    src="https://cdn.jsdelivr.net/npm/sakana-widget@2.2.2/lib/sakana.min.js">
  </script>
</body>
</html>




<script type="text/javascript" color="0,174,255" opacity='0.7' zIndex="-2" count="200" src="https://www.liuzehe.top/upload/bkjs/bj.js"></script><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/en/" title="滑翔闪&#39;S BLOG"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/%E7%9F%9B%E7%9B%BE.png"
        data-srcset="/images/%E7%9F%9B%E7%9B%BE.png, /images/%E7%9F%9B%E7%9B%BE.png 1.5x, /images/%E7%9F%9B%E7%9B%BE.png 2x"
        data-sizes="auto"
        alt="/images/%E7%9F%9B%E7%9B%BE.png"
        title="/images/%E7%9F%9B%E7%9B%BE.png" /><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/en/posts/" title="The book has its own golden house"><i class='fa fa-solid fa-book'></i> Posts </a><a class="menu-item" href="/en/tags/" title="Tag the article, don’t tag the world"><i class='fa fa-tag'></i> Tags </a><a class="menu-item" href="/en/categories/" title="Classification is a virtue"><i class='fa fa-archive'></i> Categories </a><a class="menu-item" href="/en/friends/" title=" It is always a pleasure to greet a friend from afar "><i class='fa fa-user-group'></i> Friends </a><a class="menu-item" href="/en/about/" title="People spend their whole life searching for themselves"> <i class='fa fa-address-card'></i> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="I&#39;ll search with will" id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a><a href="javascript:void(0);" class="menu-item language" title="Select Language">
                    <i class="fa fa-globe" aria-hidden="true"></i>                      
                    <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/zh-cn/posts/lda_gephi/">简体中文</option><option value="/en/posts/lda_gephi/" selected>English</option></select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/en/" title="滑翔闪&#39;S BLOG"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/images/%E7%9F%9B%E7%9B%BE.png"
        data-srcset="/images/%E7%9F%9B%E7%9B%BE.png, /images/%E7%9F%9B%E7%9B%BE.png 1.5x, /images/%E7%9F%9B%E7%9B%BE.png 2x"
        data-sizes="auto"
        alt="/images/%E7%9F%9B%E7%9B%BE.png"
        title="/images/%E7%9F%9B%E7%9B%BE.png" /><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="I&#39;ll search with will" id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/en/posts/" title="The book has its own golden house"><i class='fa fa-solid fa-book'></i>Posts</a><a class="menu-item" href="/en/tags/" title="Tag the article, don’t tag the world"><i class='fa fa-tag'></i>Tags</a><a class="menu-item" href="/en/categories/" title="Classification is a virtue"><i class='fa fa-archive'></i>Categories</a><a class="menu-item" href="/en/friends/" title=" It is always a pleasure to greet a friend from afar "><i class='fa fa-user-group'></i>Friends</a><a class="menu-item" href="/en/about/" title="People spend their whole life searching for themselves"> <i class='fa fa-address-card'></i>About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="Select Language">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/zh-cn/posts/lda_gephi/">简体中文</option><option value="/en/posts/lda_gephi/" selected>English</option></select>
                </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">LDA Topic Modeling and Gephi Visualization</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/hzp2333/hzp2333.github.io" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>滑翔闪</a></span>&nbsp;<span class="post-category">included in <a href="/en/categories/software-tools/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Software Tools</a></span></div>

            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2025-08-31">2025-08-31</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;4876 words
                <i class="far fa-clock fa-fw"></i>&nbsp;10 minutes&nbsp;
    

    
        

        
        
            <span id="busuanzi_container_value_page_pv"><i class="far fa-eye fa-fw"></i>
                
                <span id="busuanzi_value_page_pv"></span>&nbsp;views</span>
        
    


</div>

        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824180041018.webp"
        data-srcset="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824180041018.webp, /img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824180041018.webp 1.5x, /img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824180041018.webp 2x"
        data-sizes="auto"
        alt="/img/社会网络.zh-cn-20250824180041018.webp"
        title="/img/社会网络.zh-cn-20250824180041018.webp" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#lda-topic-modeling">LDA Topic Modeling</a></li>
    <li><a href="#gephi">Gephi</a>
      <ul>
        <li><a href="#examples">Examples</a></li>
        <li><a href="#analysis-software">Analysis Software</a></li>
      </ul>
    </li>
    <li><a href="#code">Code</a></li>
    <li><a href="#some-reflections">Some Reflections</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Recently, many economics papers have employed LDA topic modeling<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> and social network analysis. Here, I attempt to visualize blog topic keywords using this methodology. The workflow is as follows:</p>
<ul>
<li>Python reads markdown documents.</li>
<li>Cleans and tokenizes text.</li>
<li>Builds LDA topics.</li>
<li>Constructs network data.</li>
<li>Visualizes using Gephi.</li>
</ul>
<h2 id="lda-topic-modeling">LDA Topic Modeling</h2>
<p>LDA is an established technique in computational text analysis, yet it remains simple and effective, serving as an unsupervised machine learning method. For economics, it suffices to understand that it <strong>summarizes the number of topic keywords in a text</strong>. In top-tier journal articles, it is often used to measure data types<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.</p>
<p>Examples of applications in research papers:</p>
<ul>
<li>JPE 2025&rsquo;s &ldquo;<a href="https://www.journals.uchicago.edu/doi/full/10.1086/734874" target="_blank" rel="noopener noreffer ">More Laws, More Growth? Evidence from US States</a>&rdquo; quantifies the distribution of new legislative topics across U.S. states, examining the relationship between legislation and economic growth. Legislation related to business environment topics proves more effective, with the mechanism being investment attraction and reduced economic uncertainty.</li>
<li>RES 2025&rsquo;s &ldquo;<a href="https://academic.oup.com/restud/advance-article/doi/10.1093/restud/rdaf066/8220859" target="_blank" rel="noopener noreffer ">Women in the Courtroom: Technology and Justice</a>&rdquo; uses panel data from live courtroom broadcasting pilot cases to study female case success rates, where case types are summarized into 50 topic categories based on legal content.</li>
<li>For other text analysis references, see &ldquo;<a href="https://mp.weixin.qq.com/s/9SzkCP0kkG3gw-ca-wNqAA" target="_blank" rel="noopener noreffer ">Xiangzhang Article 3057: How to Use Text Analysis Algorithms in Economics?</a>&rdquo;</li>
</ul>
<p>For understanding LDA, I recommend a concise and intuitive <a href="https://www.youtube.com/watch?v=3mHy4OSyRf0" target="_blank" rel="noopener noreffer ">YouTube video</a> (requires VPN access):</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/3mHy4OSyRf0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<h2 id="gephi">Gephi</h2>
<h3 id="examples">Examples</h3>
<p>Gephi is a network relationship visualization software. I was first introduced to this software by my blogger friend <span class="h-card person-mention"><a href="https://www.sungyinieh.com/" class="u-url url" title="Yinieh"><img class="u-photo photo" src="Blogger" alt="Song">&#8201;<span class="p-name fn">Song</span></a></span>. He used this software in his thesis to study the <a href="https://mp.weixin.qq.com/s/M2Y3_Cre5vl7Wnk6o6J1fg" target="_blank" rel="noopener noreffer ">Global Lithium Product Trade Dependency Network</a>.</p>
<blockquote>
<p>For foundational knowledge of network analysis, I highly recommend the open-source Iris Flower statistics textbook &ldquo;<a href="https://github.com/Visualize-ML/Book6_First-Course-in-Data-Science" target="_blank" rel="noopener noreffer ">The Way of Data</a>.&rdquo;</p>
</blockquote>
<p>The most classic example of social networks is <strong>Six Degrees of Separation</strong>—<strong>through six key individuals, one can connect with anyone in the world</strong>. This theory manifests in network analysis as (shortest) paths and network connectivity.</p>
<p>The most classic dataset for social network analysis is the <strong>Karate Club</strong>. The karate club had two instructors who eventually parted ways. A statistician had previously recorded interpersonal relationships within the club, and after social network visualization and clustering, the resulting division closely matched the actual split.</p>
<p>
<figure class="center-figure"><a class="lightgallery" href="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824235924254.webp" title="Karate Club dataset visualization, source: Wikipedia" data-thumbnail="/img/社会网络.zh-cn-20250824235924254.webp" data-sub-html="<h2> </h2><p>Karate Club dataset visualization, source: Wikipedia</p>">
        <img
            class="lazyload center-image"
            src="/svg/loading.min.svg"
            data-src="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824235924254.webp"
            data-srcset="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824235924254.webp, /img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824235924254.webp 1.5x, /img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824235924254.webp 2x"
            data-sizes="auto"
            alt="/img/社会网络.zh-cn-20250824235924254.webp" />
    </a><figcaption class="image-caption">Karate Club dataset visualization, source: Wikipedia</figcaption>
    </figure></p>
<p>Social network visualization primarily involves network evolution (clustering, fragmentation), distribution<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> (key nodes, weights, density, structure<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>), and prediction.</p>
<p>The paper &ldquo;<a href="https://cfrc.pbcsf.tsinghua.edu.cn/__local/C/E3/F1/034E2CB105C230C8A028BDF18AD_5B83ADAD_18F58A.pdf?e=.pdf" target="_blank" rel="noopener noreffer ">Ownership Networks and Firm Growth: What Do Forty Million Companies Tell Us About the Chinese Economy?</a>&rdquo; studies the distribution and evolution of China&rsquo;s equity networks.</p>
<p>
<figure class="center-figure"><a class="lightgallery" href="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824230329625.webp" title="As shown" data-thumbnail="/img/社会网络.zh-cn-20250824230329625.webp" data-sub-html="<h2> </h2><p>As shown</p>">
        <img
            class="lazyload center-image"
            src="/svg/loading.min.svg"
            data-src="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824230329625.webp"
            data-srcset="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824230329625.webp, /img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824230329625.webp 1.5x, /img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824230329625.webp 2x"
            data-sizes="auto"
            alt="/img/社会网络.zh-cn-20250824230329625.webp" />
    </a><figcaption class="image-caption">As shown</figcaption>
    </figure></p>
<p>The paper &ldquo;<a href="https://arxiv.org/abs/1803.03697" target="_blank" rel="noopener noreffer ">Community Interaction and Conflict on the Web</a>&rdquo; examines Reddit community networks: <strong>less than 1% of communities initiated 74% of negative mobilization behaviors</strong>. These conflicts are typically started by core members of active communities, while the actual participants are less active peripheral members.</p>
<p>
<figure class="center-figure"><a class="lightgallery" href="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824231228354.webp" title="Reddit community network" data-thumbnail="/img/社会网络.zh-cn-20250824231228354.webp" data-sub-html="<h2> </h2><p>Reddit community network</p>">
        <img
            class="lazyload center-image"
            src="/svg/loading.min.svg"
            data-src="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824231228354.webp"
            data-srcset="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824231228354.webp, /img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824231228354.webp 1.5x, /img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824231228354.webp 2x"
            data-sizes="auto"
            alt="/img/社会网络.zh-cn-20250824231228354.webp" />
    </a><figcaption class="image-caption">Reddit community network</figcaption>
    </figure></p>
<p>Literature review software like Citespace also constitutes a form of network analysis, specifically knowledge graphs. See another blog post &ldquo;<a href="https://blog.huaxiangshan.com/zh-cn/posts/citespace/" target="_blank" rel="noopener noreffer ">Citespace Literature Visualization</a>.&rdquo;</p>
<p>Previously tested images.</p>
<p>
<figure class="center-figure"><a class="lightgallery" href="/img/Citespace%e6%96%87%e7%8c%ae%e5%8f%af%e8%a7%86%e5%8c%96.zh-cn-20240523120837358.webp" title="Anime theme, revealing Bilibili and Hatsune Miku as third-level keywords (homo is like this)" data-thumbnail="/img/Citespace文献可视化.zh-cn-20240523120837358.webp" data-sub-html="<h2> </h2><p>Anime theme, revealing Bilibili and Hatsune Miku as third-level keywords (homo is like this)</p>">
        <img
            class="lazyload center-image"
            src="/svg/loading.min.svg"
            data-src="/img/Citespace%e6%96%87%e7%8c%ae%e5%8f%af%e8%a7%86%e5%8c%96.zh-cn-20240523120837358.webp"
            data-srcset="/img/Citespace%e6%96%87%e7%8c%ae%e5%8f%af%e8%a7%86%e5%8c%96.zh-cn-20240523120837358.webp, /img/Citespace%e6%96%87%e7%8c%ae%e5%8f%af%e8%a7%86%e5%8c%96.zh-cn-20240523120837358.webp 1.5x, /img/Citespace%e6%96%87%e7%8c%ae%e5%8f%af%e8%a7%86%e5%8c%96.zh-cn-20240523120837358.webp 2x"
            data-sizes="auto"
            alt="/img/Citespace文献可视化.zh-cn-20240523120837358.webp" />
    </a><figcaption class="image-caption">Anime theme, revealing Bilibili and Hatsune Miku as third-level keywords (homo is like this)</figcaption>
    </figure></p>
<h3 id="analysis-software">Analysis Software</h3>
<blockquote>
<p>Summarized by GPT regarding available social network analysis software options.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Positioning</th>
<th>Advantages</th>
<th>Disadvantages</th>
<th>Suitable Scenarios</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Gephi</strong></td>
<td>Network Visualization + Exploration</td>
<td>User-friendly interface; rich layout algorithms; community detection features</td>
<td>Visualization-focused; not suitable for ultra-large networks</td>
<td>Rapid visualization, presentations, exploration</td>
</tr>
<tr>
<td><strong>Cytoscape</strong></td>
<td>Originally for biological networks → General-purpose</td>
<td>Rich plugin ecosystem; commonly used in research; tight integration of analysis and visualization</td>
<td>Limited performance with large-scale data; slightly complex interface</td>
<td>Bioinformatics, scientific network analysis</td>
</tr>
<tr>
<td><strong>Pajek</strong></td>
<td>Classic social network analysis software</td>
<td>Can handle million-scale networks; common in academia</td>
<td>Outdated interface; steep learning curve</td>
<td>Large-scale social network research</td>
</tr>
<tr>
<td><strong>NodeXL</strong></td>
<td>Excel plugin (Microsoft ecosystem)</td>
<td>Quick to learn; convenient for social media data scraping</td>
<td>Limited features; full version requires commercial license</td>
<td>Social media network analysis for beginners</td>
</tr>
<tr>
<td><strong>Python</strong></td>
<td>NetworkX / igraph programming tools</td>
<td>Flexible; customizable; can integrate with machine learning and text mining</td>
<td>No visualization interface; requires coding</td>
<td>Highly flexible, research experiments</td>
</tr>
</tbody>
</table>
<h2 id="code">Code</h2>
<p>Three folders:</p>
<ol>
<li>Blog markdown folder (original blog <code>.md</code> files)</li>
<li>Tokenization folder (txt documents with one word per line, e.g., 了, 的, 得, 地, 他, 她, 滑翔闪&hellip;)</li>
<li>Results folder</li>
</ol>
<p>I used <code>jieba</code> for tokenization and <code>gensim.models</code> for model training. For further optimization, modifications can be made at these stages<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup>.</p>
<blockquote>
<p>Note the version compatibility issues between <code>gensim</code> and <code>numpy</code>.</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">glob</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">itertools</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">jieba</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">gensim</span> <span class="kn">import</span> <span class="n">corpora</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">gensim.models</span> <span class="kn">import</span> <span class="n">LdaModel</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Global configuration parameters</span>
</span></span><span class="line"><span class="cl"><span class="n">DOCS_GLOB</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">PyTorch_practice</span><span class="se">\\</span><span class="s1">博客分析</span><span class="se">\\</span><span class="s1">数据</span><span class="se">\\</span><span class="s1">原始博客</span><span class="se">\\</span><span class="s1">*.md&#39;</span>   <span class="c1"># Document path pattern</span>
</span></span><span class="line"><span class="cl"><span class="n">STOPWORDS_PATH</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">PyTorch_practice</span><span class="se">\\</span><span class="s1">博客分析</span><span class="se">\\</span><span class="s1">数据</span><span class="se">\\</span><span class="s1">设置</span><span class="se">\\</span><span class="s1">分词stop.txt&#39;</span>  <span class="c1"># Optional stopwords file</span>
</span></span><span class="line"><span class="cl"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;D:</span><span class="se">\\</span><span class="s1">PyTorch_practice</span><span class="se">\\</span><span class="s1">博客分析</span><span class="se">\\</span><span class="s1">数据</span><span class="se">\\</span><span class="s1">结果输出</span><span class="se">\\</span><span class="s1">&#39;</span>       <span class="c1"># Unified output folder</span>
</span></span><span class="line"><span class="cl"><span class="n">NO_BELOW</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Words with frequency below this threshold will be filtered</span>
</span></span><span class="line"><span class="cl"><span class="n">NO_ABOVE</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Words with frequency above this proportion will be filtered</span>
</span></span><span class="line"><span class="cl"><span class="n">KEEP_N</span> <span class="o">=</span> <span class="mi">100000</span>  <span class="c1"># Number of highest-frequency words to retain</span>
</span></span><span class="line"><span class="cl"><span class="n">NUM_TOPICS</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Number of topics</span>
</span></span><span class="line"><span class="cl"><span class="n">TOPN</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of keywords to display per topic</span>
</span></span><span class="line"><span class="cl"><span class="n">MAX_EDGES</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1"># Maximum number of edges to retain in word co-occurrence graph</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Default stopwords set</span>
</span></span><span class="line"><span class="cl"><span class="n">DEFAULT_STOPWORDS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;的&#39;</span><span class="p">,</span> <span class="s1">&#39;了&#39;</span><span class="p">,</span> <span class="s1">&#39;和&#39;</span><span class="p">,</span> <span class="s1">&#39;是&#39;</span><span class="p">,</span> <span class="s1">&#39;在&#39;</span><span class="p">,</span> <span class="s1">&#39;就&#39;</span><span class="p">,</span> <span class="s1">&#39;都&#39;</span><span class="p">,</span> <span class="s1">&#39;而&#39;</span><span class="p">,</span> <span class="s1">&#39;及&#39;</span><span class="p">,</span> <span class="s1">&#39;与&#39;</span><span class="p">,</span> <span class="s1">&#39;或&#39;</span><span class="p">,</span> <span class="s1">&#39;一个&#39;</span><span class="p">,</span> <span class="s1">&#39;我&#39;</span><span class="p">,</span> <span class="s1">&#39;你&#39;</span><span class="p">,</span> <span class="s1">&#39;他&#39;</span><span class="p">,</span> <span class="s1">&#39;她&#39;</span><span class="p">,</span> <span class="s1">&#39;它&#39;</span><span class="p">,</span> <span class="s1">&#39;我们&#39;</span><span class="p">,</span> <span class="s1">&#39;你们&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;他们&#39;</span><span class="p">,</span> <span class="s1">&#39;她们&#39;</span><span class="p">,</span> <span class="s1">&#39;这&#39;</span><span class="p">,</span> <span class="s1">&#39;那&#39;</span><span class="p">,</span> <span class="s1">&#39;其&#39;</span><span class="p">,</span> <span class="s1">&#39;又&#39;</span><span class="p">,</span> <span class="s1">&#39;被&#39;</span><span class="p">,</span> <span class="s1">&#39;上&#39;</span><span class="p">,</span> <span class="s1">&#39;中&#39;</span><span class="p">,</span> <span class="s1">&#39;对&#39;</span><span class="p">,</span> <span class="s1">&#39;所&#39;</span><span class="p">,</span> <span class="s1">&#39;为&#39;</span><span class="p">,</span> <span class="s1">&#39;于&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">load_stopwords</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Load stopwords list&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sw</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">w</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">w</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">sw</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed to read stopwords file </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># If custom stopwords is empty, use default stopwords</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">sw</span> <span class="k">if</span> <span class="n">sw</span> <span class="k">else</span> <span class="n">DEFAULT_STOPWORDS</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">load_documents</span><span class="p">(</span><span class="n">glob_pattern</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Load document collection&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">docs</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Get matching file list</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">glob_pattern</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No matching files found: </span><span class="si">{</span><span class="n">glob_pattern</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">filenames</span><span class="p">,</span> <span class="n">docs</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span><span class="si">}</span><span class="s1"> files&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Read each file content</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed to read file </span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">filenames</span><span class="p">,</span> <span class="n">docs</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Text cleaning and tokenization</span>
</span></span><span class="line"><span class="cl"><span class="n">RE_CLEAN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;[\s\d\u0000-\u007F]+&#34;</span><span class="p">)</span>  <span class="c1"># Remove ascii/digits/excessive whitespace, retain Chinese characters and punctuation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Text preprocessing: cleaning, tokenization, filtering&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">RE_CLEAN</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">tokens</span> <span class="o">=</span> <span class="n">jieba</span><span class="o">.</span><span class="n">lcut</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Filter stopwords and single-character words</span>
</span></span><span class="line"><span class="cl">    <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tokens</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">tokens</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">build_cooccurrence</span><span class="p">(</span><span class="n">tokens_list</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Build word co-occurrence matrix&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cooc</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">freq</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">tokens_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Deduplicate words within each document</span>
</span></span><span class="line"><span class="cl">        <span class="n">unique_tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">tokens</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Update word frequency</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">unique_tokens</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">freq</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Build co-occurrence relationships</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">unique_tokens</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Ensure ordering to avoid duplicate counting</span>
</span></span><span class="line"><span class="cl">                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span> <span class="k">else</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">cooc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">freq</span><span class="p">,</span> <span class="n">cooc</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Main function&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Create output directory</span>
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading stopwords...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">stopwords</span> <span class="o">=</span> <span class="n">load_stopwords</span><span class="p">(</span><span class="n">STOPWORDS_PATH</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stopwords</span><span class="p">)</span><span class="si">}</span><span class="s1"> stopwords&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading documents...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">filenames</span><span class="p">,</span> <span class="n">docs</span> <span class="o">=</span> <span class="n">load_documents</span><span class="p">(</span><span class="n">DOCS_GLOB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span><span class="s1"> documents&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No documents found, check DOCS_GLOB setting&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tokenizing and preprocessing... (this may take some time)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">preprocess</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Statistics for processed vocabulary</span>
</span></span><span class="line"><span class="cl">    <span class="n">total_tokens</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Preprocessing complete, processed </span><span class="si">{</span><span class="n">total_tokens</span><span class="si">}</span><span class="s1"> tokens&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Build dictionary and corpus</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Building dictionary and corpus...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dictionary</span> <span class="o">=</span> <span class="n">corpora</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">original_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dictionary</span><span class="o">.</span><span class="n">filter_extremes</span><span class="p">(</span><span class="n">no_below</span><span class="o">=</span><span class="n">NO_BELOW</span><span class="p">,</span> <span class="n">no_above</span><span class="o">=</span><span class="n">NO_ABOVE</span><span class="p">,</span> <span class="n">keep_n</span><span class="o">=</span><span class="n">KEEP_N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">filtered_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dictionary filtering: </span><span class="si">{</span><span class="n">original_size</span><span class="si">}</span><span class="s1"> -&gt; </span><span class="si">{</span><span class="n">filtered_size</span><span class="si">}</span><span class="s1"> words&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">corpus</span> <span class="o">=</span> <span class="p">[</span><span class="n">dictionary</span><span class="o">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Train LDA model</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training LDA model...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">lda</span> <span class="o">=</span> <span class="n">LdaModel</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">corpus</span><span class="o">=</span><span class="n">corpus</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">id2word</span><span class="o">=</span><span class="n">dictionary</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">num_topics</span><span class="o">=</span><span class="n">NUM_TOPICS</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">passes</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">per_word_topics</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Save model</span>
</span></span><span class="line"><span class="cl">    <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="s1">&#39;lda_model.model&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">lda</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;LDA model saved: </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Output topic-word distribution</span>
</span></span><span class="line"><span class="cl">    <span class="n">topics</span> <span class="o">=</span> <span class="n">lda</span><span class="o">.</span><span class="n">show_topics</span><span class="p">(</span><span class="n">num_topics</span><span class="o">=</span><span class="n">NUM_TOPICS</span><span class="p">,</span> <span class="n">num_words</span><span class="o">=</span><span class="n">TOPN</span><span class="p">,</span> <span class="n">formatted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Topic keywords (one topic per line):&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">rows_kw</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">tid</span><span class="p">,</span> <span class="n">terms</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">topic_words</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">)&#39;</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Topic </span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">topic_words</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">rank</span><span class="p">,</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">prob</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">rows_kw</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="n">tid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;rank&#39;</span><span class="p">:</span> <span class="n">rank</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="n">word</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Save topic keywords</span>
</span></span><span class="line"><span class="cl">    <span class="n">kw_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="s1">&#39;topic_keywords.csv&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_kw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows_kw</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_kw</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">kw_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Topic keywords saved: </span><span class="si">{</span><span class="n">kw_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Export document-topic distribution</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exporting document-topic distribution...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">doc_id</span><span class="p">,</span> <span class="n">bow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corpus</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">doc_topics</span> <span class="o">=</span> <span class="n">lda</span><span class="o">.</span><span class="n">get_document_topics</span><span class="p">(</span><span class="n">bow</span><span class="p">,</span> <span class="n">minimum_probability</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">tid</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">doc_topics</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;doc&#39;</span><span class="p">:</span> <span class="n">filenames</span><span class="p">[</span><span class="n">doc_id</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;doc_id&#39;</span><span class="p">:</span> <span class="n">doc_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">tid</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">dt_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="s1">&#39;doc_topic.csv&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_dt</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">dt_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Document-topic distribution saved: </span><span class="si">{</span><span class="n">dt_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Build topic-term bipartite graph</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Building topic-term bipartite graph...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">tid</span><span class="p">,</span> <span class="n">terms</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Use top 3 keywords as topic name</span>
</span></span><span class="line"><span class="cl">        <span class="n">top_words</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">[:</span><span class="mi">3</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">        <span class="n">topic_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;Topic_</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s2">_&#34;</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">top_words</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;topic_</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">topic_label</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;topic&#39;</span><span class="p">,</span> <span class="n">topic_id</span><span class="o">=</span><span class="n">tid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">tid</span><span class="p">,</span> <span class="n">terms</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">G</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">term</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">term</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;term&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">weight</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;topic_</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Save bipartite graph</span>
</span></span><span class="line"><span class="cl">    <span class="n">bipartite_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="s1">&#39;gephi_topic_term.gexf&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">nx</span><span class="o">.</span><span class="n">write_gexf</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">bipartite_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Topic-Term bipartite graph saved: </span><span class="si">{</span><span class="n">bipartite_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Build word co-occurrence graph</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Building word co-occurrence graph...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">freq</span><span class="p">,</span> <span class="n">cooc</span> <span class="o">=</span> <span class="n">build_cooccurrence</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Sort edges by weight, keep only top MAX_EDGES edges</span>
</span></span><span class="line"><span class="cl">    <span class="n">sorted_edges</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cooc</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Collect all nodes to keep (nodes appearing in top MAX_EDGES edges)</span>
</span></span><span class="line"><span class="cl">    <span class="n">nodes_to_keep</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">edges_to_keep</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">sorted_edges</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges_to_keep</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">MAX_EDGES</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="n">nodes_to_keep</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">nodes_to_keep</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">edges_to_keep</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">w</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Create graph, add only nodes and edges to keep</span>
</span></span><span class="line"><span class="cl">    <span class="n">H</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Add nodes (only those appearing in edges)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes_to_keep</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">freq</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">H</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="n">node</span><span class="p">]),</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;term&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Add edges</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">edges_to_keep</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">H</span> <span class="ow">and</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">H</span><span class="p">:</span>  <span class="c1"># Ensure both nodes exist</span>
</span></span><span class="line"><span class="cl">            <span class="n">H</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Remove isolated nodes (if any)</span>
</span></span><span class="line"><span class="cl">    <span class="n">H</span><span class="o">.</span><span class="n">remove_nodes_from</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">isolates</span><span class="p">(</span><span class="n">H</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Word co-occurrence graph contains </span><span class="si">{</span><span class="n">H</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span><span class="si">}</span><span class="s1"> nodes and </span><span class="si">{</span><span class="n">H</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span><span class="si">}</span><span class="s1"> edges&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Save co-occurrence graph</span>
</span></span><span class="line"><span class="cl">    <span class="n">cooccurrence_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="s1">&#39;gephi_term_cooccurrence.gexf&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">nx</span><span class="o">.</span><span class="n">write_gexf</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">cooccurrence_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Word co-occurrence graph saved: </span><span class="si">{</span><span class="n">cooccurrence_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Output summary information</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">All tasks completed. Generated files:&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_files</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;lda_model.model&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;topic_keywords.csv&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;doc_topic.csv&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;gephi_topic_term.gexf&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;gephi_term_cooccurrence.gexf&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">output_files</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; - </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">file_size</span><span class="o">/</span><span class="mi">1024</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> KB)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; - </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1"> (file not generated)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Gephi visualization suggestions:&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1. Open Gephi: File → Open → Select .gexf file&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;2. Use Layout (e.g., ForceAtlas2) for arrangement&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;3. Color/filter based on node attribute &#34;type&#34;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;4. Adjust node size based on degree/weight&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>After using the code to generate the graph file <code>gephi_topic_term.gexf</code>,</p>
<ol>
<li>Open Gephi: File → Open → Select .gexf file</li>
<li>Use Layout (e.g., ForceAtlas2) for arrangement</li>
<li>Color/filter based on node attribute &ldquo;type&rdquo;</li>
<li>Adjust node size based on degree/weight</li>
</ol>
<p>If you&rsquo;ve used Citespace, you&rsquo;ll find Gephi&rsquo;s beautification operations familiar<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup>. Personally, I feel this type of visualization primarily serves to intuitively present clustering structures, but in practice, large datasets struggle with force-directed graph visualization. <strong>The focus of social network analysis lies in capturing and measuring special structures and important nodes.</strong></p>
<p>After using LDA to generate topics and words, the visualization results are as follows:</p>
<p>It appears my blog revolves around <strong>economics</strong>, branching out to software and sub-disciplines. Movie reviews and other software topics are indeed isolated at the farthest edges.</p>
<p>
<figure class="center-figure"><a class="lightgallery" href="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824180041018.webp" title="LDA generated topics|444x221" data-thumbnail="/img/社会网络.zh-cn-20250824180041018.webp" data-sub-html="<h2> </h2><p>LDA generated topics|444x221</p>">
        <img
            class="lazyload center-image"
            src="/svg/loading.min.svg"
            data-src="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824180041018.webp"
            data-srcset="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824180041018.webp, /img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824180041018.webp 1.5x, /img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-20250824180041018.webp 2x"
            data-sizes="auto"
            alt="/img/社会网络.zh-cn-20250824180041018.webp" />
    </a><figcaption class="image-caption">LDA generated topics|444x221</figcaption>
    </figure></p>
<p>The following image results from optimized code using <code>jieba</code> to further remove adverbs and adjectives. Personally, I feel this type of image summary is quite effective.</p>
<p>
<figure class="center-figure"><a class="lightgallery" href="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-1759046125538.webp" title="As shown" data-thumbnail="/img/社会网络.zh-cn-1759046125538.webp" data-sub-html="<h2> </h2><p>As shown</p>">
        <img
            class="lazyload center-image"
            src="/svg/loading.min.svg"
            data-src="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-1759046125538.webp"
            data-srcset="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-1759046125538.webp, /img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-1759046125538.webp 1.5x, /img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-1759046125538.webp 2x"
            data-sizes="auto"
            alt="/img/社会网络.zh-cn-1759046125538.webp" />
    </a><figcaption class="image-caption">As shown</figcaption>
    </figure>

<figure class="center-figure"><a class="lightgallery" href="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-1759046196231.webp" title="15 topics" data-thumbnail="/img/社会网络.zh-cn-1759046196231.webp" data-sub-html="<h2> </h2><p>15 topics</p>">
        <img
            class="lazyload center-image"
            src="/svg/loading.min.svg"
            data-src="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-1759046196231.webp"
            data-srcset="/img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-1759046196231.webp, /img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-1759046196231.webp 1.5x, /img/%e7%a4%be%e4%bc%9a%e7%bd%91%e7%bb%9c.zh-cn-1759046196231.webp 2x"
            data-sizes="auto"
            alt="/img/社会网络.zh-cn-1759046196231.webp" />
    </a><figcaption class="image-caption">15 topics</figcaption>
    </figure></p>
<p>Optimized code (my personal laptop couldn&rsquo;t handle it, so I bought a cheap cloud server to run it).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># -*- coding: utf-8 -*-</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">Optimized LDA pipeline: Supports Markdown (.md) documents, automatic stopwords, part-of-speech filtering
</span></span></span><span class="line"><span class="cl"><span class="s2">- Uses LdaMulticore for multi-threaded training
</span></span></span><span class="line"><span class="cl"><span class="s2">- Supports whitelist words to force retention as topic keywords
</span></span></span><span class="line"><span class="cl"><span class="s2">- Directly generates Gephi bipartite graphs
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">glob</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">jieba</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">jieba.posseg</span> <span class="k">as</span> <span class="nn">pseg</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">gensim</span> <span class="kn">import</span> <span class="n">corpora</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">gensim.models.ldamulticore</span> <span class="kn">import</span> <span class="n">LdaMulticore</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Markdown parsing</span>
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">markdown</span>
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Error: Missing required libraries, please execute &#39;pip install markdown beautifulsoup4&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------- Configuration --------------------</span>
</span></span><span class="line"><span class="cl"><span class="n">DOCS_GLOB</span> <span class="o">=</span> <span class="s2">&#34;/root/博客分析/数据/原始博客/*.md&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">STOPWORDS_PATH</span> <span class="o">=</span> <span class="s2">&#34;/root/博客分析/数据/设置/分词stop.txt&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="s2">&#34;/root/博客分析/数据/结果输出&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Dictionary and corpus parameters</span>
</span></span><span class="line"><span class="cl"><span class="n">NO_BELOW</span> <span class="o">=</span> <span class="mi">3</span>            <span class="c1"># Minimum document frequency for words</span>
</span></span><span class="line"><span class="cl"><span class="n">NO_ABOVE</span> <span class="o">=</span> <span class="mf">0.8</span>          <span class="c1"># Maximum document frequency proportion for words</span>
</span></span><span class="line"><span class="cl"><span class="n">KEEP_N</span> <span class="o">=</span> <span class="mi">100000</span>              <span class="c1"># Maximum dictionary size</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># LDA model parameters</span>
</span></span><span class="line"><span class="cl"><span class="n">NUM_TOPICS</span> <span class="o">=</span> <span class="mi">10</span>         <span class="c1"># Number of topics</span>
</span></span><span class="line"><span class="cl"><span class="n">TOPN</span> <span class="o">=</span> <span class="mi">15</span>               <span class="c1"># Number of keywords per topic</span>
</span></span><span class="line"><span class="cl"><span class="n">PASSES</span> <span class="o">=</span> <span class="mi">20</span>             <span class="c1"># LDA training passes</span>
</span></span><span class="line"><span class="cl"><span class="n">WORKERS</span> <span class="o">=</span> <span class="mi">28</span>             <span class="c1"># Number of threads (recommended = CPU cores - 1)</span>
</span></span><span class="line"><span class="cl"><span class="n">CHUNKSIZE</span> <span class="o">=</span> <span class="mi">5000</span>        <span class="c1"># Documents per batch</span>
</span></span><span class="line"><span class="cl"><span class="n">BATCH</span> <span class="o">=</span> <span class="kc">True</span>            <span class="c1"># Whether to use mini-batch training</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Tokenization and stopwords</span>
</span></span><span class="line"><span class="cl"><span class="n">USE_POS_FILTER</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">POS_BLACKLIST</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">USE_AUTO_DF_STOPWORDS</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">AUTO_DF_THRESHOLD</span> <span class="o">=</span> <span class="mf">0.8</span>
</span></span><span class="line"><span class="cl"><span class="n">AUTO_DF_TOPK</span> <span class="o">=</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Additional stopwords</span>
</span></span><span class="line"><span class="cl"><span class="n">ADDITIONAL_STOPWORDS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;什么&#39;</span><span class="p">,</span> <span class="s1">&#39;推荐&#39;</span><span class="p">,</span> <span class="s1">&#39;获取&#39;</span><span class="p">,</span> <span class="s1">&#39;点击&#39;</span><span class="p">,</span> <span class="s1">&#39;生成&#39;</span><span class="p">,</span> <span class="s1">&#39;绘制&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;存在&#39;</span><span class="p">,</span> <span class="s1">&#39;问题&#39;</span><span class="p">,</span> <span class="s1">&#39;使用&#39;</span><span class="p">,</span> <span class="s1">&#39;可以&#39;</span><span class="p">,</span> <span class="s1">&#39;我们&#39;</span><span class="p">,</span> <span class="s1">&#39;现在&#39;</span><span class="p">,</span> <span class="s1">&#39;通过&#39;</span><span class="p">,</span> <span class="s1">&#39;文章&#39;</span><span class="p">,</span> <span class="s1">&#39;内容&#39;</span><span class="p">,</span> <span class="s1">&#39;研究法&#39;</span><span class="p">,</span> <span class="s1">&#39;人为&#39;</span><span class="p">,</span> <span class="s1">&#39;保留&#39;</span><span class="p">,</span> <span class="s1">&#39;来讲&#39;</span><span class="p">,</span> <span class="s1">&#39;叫魂&#39;</span><span class="p">,</span> <span class="s1">&#39;学家&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">DEFAULT_STOPWORDS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;的&#39;</span><span class="p">,</span> <span class="s1">&#39;了&#39;</span><span class="p">,</span> <span class="s1">&#39;和&#39;</span><span class="p">,</span> <span class="s1">&#39;是&#39;</span><span class="p">,</span> <span class="s1">&#39;在&#39;</span><span class="p">,</span> <span class="s1">&#39;就&#39;</span><span class="p">,</span> <span class="s1">&#39;都&#39;</span><span class="p">,</span> <span class="s1">&#39;而&#39;</span><span class="p">,</span> <span class="s1">&#39;及&#39;</span><span class="p">,</span> <span class="s1">&#39;与&#39;</span><span class="p">,</span> <span class="s1">&#39;或&#39;</span><span class="p">,</span> <span class="s1">&#39;一个&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;我&#39;</span><span class="p">,</span> <span class="s1">&#39;你&#39;</span><span class="p">,</span> <span class="s1">&#39;他&#39;</span><span class="p">,</span> <span class="s1">&#39;她&#39;</span><span class="p">,</span> <span class="s1">&#39;它&#39;</span><span class="p">,</span> <span class="s1">&#39;我们&#39;</span><span class="p">,</span> <span class="s1">&#39;你们&#39;</span><span class="p">,</span> <span class="s1">&#39;他们&#39;</span><span class="p">,</span> <span class="s1">&#39;她们&#39;</span><span class="p">,</span> <span class="s1">&#39;这&#39;</span><span class="p">,</span> <span class="s1">&#39;那&#39;</span><span class="p">,</span> <span class="s1">&#39;其&#39;</span><span class="p">,</span> <span class="s1">&#39;又&#39;</span><span class="p">,</span> <span class="s1">&#39;被&#39;</span><span class="p">,</span> <span class="s1">&#39;上&#39;</span><span class="p">,</span> <span class="s1">&#39;中&#39;</span><span class="p">,</span> <span class="s1">&#39;对&#39;</span><span class="p">,</span> <span class="s1">&#39;所&#39;</span><span class="p">,</span> <span class="s1">&#39;为&#39;</span><span class="p">,</span> <span class="s1">&#39;于&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Whitelist words (force retention as topic keywords)</span>
</span></span><span class="line"><span class="cl"><span class="n">WHITELIST_WORDS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;经济&#39;</span><span class="p">,</span> <span class="s1">&#39;国家&#39;</span><span class="p">,</span> <span class="s1">&#39;政府&#39;</span><span class="p">,</span> <span class="s1">&#39;政策&#39;</span><span class="p">,</span> <span class="s1">&#39;文学&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Text cleaning regex</span>
</span></span><span class="line"><span class="cl"><span class="n">RE_CLEAN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;[\s\d\u0000-\u007F]+&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------- Functions --------------------</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">extract_text_from_markdown</span><span class="p">(</span><span class="n">md_content</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">html</span> <span class="o">=</span> <span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">md_content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">soup</span><span class="p">([</span><span class="s1">&#39;pre&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="n">tag</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">(</span><span class="n">separator</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">load_stopwords</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">sw</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">w</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">w</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">sw</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">combined</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_STOPWORDS</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">ADDITIONAL_STOPWORDS</span><span class="p">)</span> <span class="o">|</span> <span class="n">sw</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">combined</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">load_documents</span><span class="p">(</span><span class="n">glob_pattern</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">docs</span><span class="p">,</span> <span class="n">filenames</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">glob_pattern</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No files found: </span><span class="si">{</span><span class="n">glob_pattern</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">filenames</span><span class="p">,</span> <span class="n">docs</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span><span class="si">}</span><span class="s1"> files&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">raw_text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">raw_text</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">clean_text</span> <span class="o">=</span> <span class="n">extract_text_from_markdown</span><span class="p">(</span><span class="n">raw_text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clean_text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed to read </span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">filenames</span><span class="p">,</span> <span class="n">docs</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">auto_find_generic_terms</span><span class="p">(</span><span class="n">tokens_list</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">AUTO_DF_THRESHOLD</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="n">AUTO_DF_TOPK</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">n_docs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">n_docs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">tokens_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">df</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_ratio</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="p">:</span> <span class="n">cnt</span> <span class="o">/</span> <span class="n">n_docs</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">    <span class="n">high_df</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">df_ratio</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">high_df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">top_k</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">sorted_by_df</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">high_df</span> <span class="o">|=</span> <span class="p">{</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">sorted_by_df</span><span class="p">[:</span><span class="n">top_k</span><span class="p">]}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">high_df</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">,</span> <span class="n">use_pos_filter</span><span class="o">=</span><span class="n">USE_POS_FILTER</span><span class="p">,</span> <span class="n">pos_blacklist</span><span class="o">=</span><span class="n">POS_BLACKLIST</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">RE_CLEAN</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">use_pos_filter</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">pseg</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">short_flag</span> <span class="o">=</span> <span class="n">flag</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">flag</span> <span class="k">else</span> <span class="n">flag</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">short_flag</span> <span class="ow">in</span> <span class="n">pos_blacklist</span> <span class="ow">or</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">stopwords</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">w</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">WHITELIST_WORDS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="cl">            <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">words</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">jieba</span><span class="o">.</span><span class="n">lcut</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span> <span class="ow">or</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">WHITELIST_WORDS</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">tokens</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -------------------- Main workflow --------------------</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading stopwords...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">stopwords</span> <span class="o">=</span> <span class="n">load_stopwords</span><span class="p">(</span><span class="n">STOPWORDS_PATH</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">stopwords</span><span class="p">)</span><span class="si">}</span><span class="s1"> stopwords&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading Markdown documents...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">filenames</span><span class="p">,</span> <span class="n">docs</span> <span class="o">=</span> <span class="n">load_documents</span><span class="p">(</span><span class="n">DOCS_GLOB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Successfully processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span><span class="s1"> documents&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Text preprocessing...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">preprocess</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">USE_AUTO_DF_STOPWORDS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Automatically detecting high-frequency generic terms...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">detected</span> <span class="o">=</span> <span class="n">auto_find_generic_terms</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">detected</span> <span class="o">-=</span> <span class="n">WHITELIST_WORDS</span>  <span class="c1"># Whitelist words not added to stopwords</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">detected</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Detected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">detected</span><span class="p">)</span><span class="si">}</span><span class="s1"> generic terms, adding to stopwords and reprocessing&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">stopwords</span> <span class="o">|=</span> <span class="n">detected</span>
</span></span><span class="line"><span class="cl">            <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">preprocess</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">stopwords</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">total_tokens</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Total </span><span class="si">{</span><span class="n">total_tokens</span><span class="si">}</span><span class="s1"> valid tokens&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Building dictionary and corpus...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dictionary</span> <span class="o">=</span> <span class="n">corpora</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dictionary</span><span class="o">.</span><span class="n">filter_extremes</span><span class="p">(</span><span class="n">no_below</span><span class="o">=</span><span class="n">NO_BELOW</span><span class="p">,</span> <span class="n">no_above</span><span class="o">=</span><span class="n">NO_ABOVE</span><span class="p">,</span> <span class="n">keep_n</span><span class="o">=</span><span class="n">KEEP_N</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">corpus</span> <span class="o">=</span> <span class="p">[</span><span class="n">dictionary</span><span class="o">.</span><span class="n">doc2bow</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Document count: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span><span class="si">}</span><span class="s1">, Dictionary size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dictionary</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training LDA model (multi-threaded)...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">lda</span> <span class="o">=</span> <span class="n">LdaMulticore</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">corpus</span><span class="o">=</span><span class="n">corpus</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">id2word</span><span class="o">=</span><span class="n">dictionary</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">num_topics</span><span class="o">=</span><span class="n">NUM_TOPICS</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">passes</span><span class="o">=</span><span class="n">PASSES</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">workers</span><span class="o">=</span><span class="n">WORKERS</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">chunksize</span><span class="o">=</span><span class="n">CHUNKSIZE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">batch</span><span class="o">=</span><span class="n">BATCH</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">per_word_topics</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="s1">&#39;lda_model.model&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">lda</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;LDA model saved: </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Topic keywords</span>
</span></span><span class="line"><span class="cl">    <span class="n">topics</span> <span class="o">=</span> <span class="n">lda</span><span class="o">.</span><span class="n">show_topics</span><span class="p">(</span><span class="n">num_topics</span><span class="o">=</span><span class="n">NUM_TOPICS</span><span class="p">,</span> <span class="n">num_words</span><span class="o">=</span><span class="n">TOPN</span><span class="p">,</span> <span class="n">formatted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">rows_kw</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Topic keywords:&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">tid</span><span class="p">,</span> <span class="n">terms</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">topic_words</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">)&#39;</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Topic </span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">topic_words</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">rank</span><span class="p">,</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">prob</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">rows_kw</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="n">tid</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span><span class="p">:</span> <span class="n">rank</span><span class="p">,</span> <span class="s1">&#39;word&#39;</span><span class="p">:</span> <span class="n">word</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows_kw</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="s1">&#39;topic_keywords.csv&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                                 <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Document-topic distribution</span>
</span></span><span class="line"><span class="cl">    <span class="n">rows_dt</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">doc_id</span><span class="p">,</span> <span class="n">bow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corpus</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">doc_topics</span> <span class="o">=</span> <span class="n">lda</span><span class="o">.</span><span class="n">get_document_topics</span><span class="p">(</span><span class="n">bow</span><span class="p">,</span> <span class="n">minimum_probability</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">tid</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">doc_topics</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rows_dt</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;doc&#39;</span><span class="p">:</span> <span class="n">filenames</span><span class="p">[</span><span class="n">doc_id</span><span class="p">],</span> <span class="s1">&#39;doc_id&#39;</span><span class="p">:</span> <span class="n">doc_id</span><span class="p">,</span> <span class="s1">&#39;topic&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">tid</span><span class="p">),</span> <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">weight</span><span class="p">)})</span>
</span></span><span class="line"><span class="cl">    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows_dt</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="s1">&#39;doc_topic.csv&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                                 <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8-sig&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Document-topic distribution saved&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Build Topic-Term bipartite graph</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Building Topic-Term bipartite graph...&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">tid</span><span class="p">,</span> <span class="n">terms</span> <span class="ow">in</span> <span class="n">topics</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">top_words</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">[:</span><span class="mi">3</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">        <span class="n">topic_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;Topic_</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s2">_&#34;</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">top_words</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;topic_</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">topic_label</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;topic&#39;</span><span class="p">,</span> <span class="n">topic_id</span><span class="o">=</span><span class="n">tid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">term</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">G</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">term</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">term</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;term&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;topic_</span><span class="si">{</span><span class="n">tid</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">prob</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">nx</span><span class="o">.</span><span class="n">write_gexf</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="s1">&#39;gephi_topic_term.gexf&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Topic-Term bipartite graph saved&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Output file information</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">All tasks completed! Generated files:&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lda_model.model&#39;</span><span class="p">,</span> <span class="s1">&#39;topic_keywords.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;doc_topic.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;gephi_topic_term.gexf&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">OUTPUT_DIR</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; - </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">/</span><span class="mi">1024</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> KB)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="some-reflections">Some Reflections</h2>
<p>I often criticize machine learning as a black box, but for someone like me who uses various analysis software, how different are many software methods from black boxes? If a Stata external command has an error, without deep understanding or theoretical cross-validation from multiple perspectives, it&rsquo;s difficult to detect the mistake.</p>
<p>For example, <a href="https://mp.weixin.qq.com/s/IsuB02q6Lek07Oxknvx6Vw" target="_blank" rel="noopener noreffer ">&ldquo;Stata&rdquo; bdiff+reghdfe correct usage, many papers have been misled</a>. I recall a previous did external command also had errors.</p>
<p>I believe AI will enhance positive feedback in code-based learning, but simultaneously, AI also brings the illusion of &ldquo;I understand.&rdquo; As Feynman consistently emphasized—<strong>knowing and understanding are not the same</strong><sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup>. Running code and understanding code are far from the same level of learning. In the era of AI learning knowledge illusions, what truly constitutes understanding? Perhaps this needs to be reconsidered.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Although LDA is an old method, economics excels at repurposing established techniques.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>In recent years, the exploration of heterogeneous agents has become increasingly important&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>Descriptive statistics alone can be sufficiently eye-catching.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>Viewing the universe as a network space, recent research suggests Earth may reside within a cosmic void. After reading a Zhihu answer about interstellar travel <a href="https://www.zhihu.com/question/329908379/answer/1943305925965374152" target="_blank" rel="noopener noreffer ">(Can humans truly never leave the Laniakea Supercluster?)</a>, I no longer believe in extraterrestrials on Earth 😢.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>With AI, data analysis isn&rsquo;t difficult; the challenge lies in obtaining suitable materials.&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>However, with large datasets, beautification calculations for dispersed distributions become too complex and are rarely used.&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7">
<p>Hence Feynman&rsquo;s criticism that social sciences might be pseudoscience.&#160;<a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2025-08-31</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/en/posts/lda_gephi/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://blog.huaxiangshan.com/en/posts/lda_gephi/" data-title="LDA Topic Modeling and Gephi Visualization" data-via="ygVNLSZ1omFBCeB" data-hashtags="Gephi,Python,Network"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://blog.huaxiangshan.com/en/posts/lda_gephi/" data-hashtag="Gephi"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://blog.huaxiangshan.com/en/posts/lda_gephi/" data-title="LDA Topic Modeling and Gephi Visualization"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://blog.huaxiangshan.com/en/posts/lda_gephi/" data-title="LDA Topic Modeling and Gephi Visualization"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://blog.huaxiangshan.com/en/posts/lda_gephi/" data-title="LDA Topic Modeling and Gephi Visualization" data-image="/img/社会网络.zh-cn-20250824180041018.webp"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/en/tags/gephi/">Gephi</a>,&nbsp;<a href="/en/tags/python/">Python</a>,&nbsp;<a href="/en/tags/network/">Network</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/en/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/en/posts/sgns/" class="prev" rel="prev" title="Siguniang Mountain: A Hiking Journey at the Foot of Snow-Capped Peaks"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Siguniang Mountain: A Hiking Journey at the Foot of Snow-Capped Peaks</a>
            <a href="/en/posts/gzhs/" class="next" rel="next" title="Explaining the &#34;Trendy Toy Craze&#34;: From Network Effects to Multiple Equilibria">Explaining the "Trendy Toy Craze": From Network Effects to Multiple Equilibria<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="giscus" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://giscus.app">Giscus</a>.
            </noscript></div></article></div>
            </main><script>

(function() {
  console.log('[Music Player] Enhanced initialization script loaded');

  
  const CDN_SOURCES = [
    'https://cdn.jsdelivr.net/npm/',
    'https://unpkg.com/',
    'https://cdnjs.cloudflare.com/ajax/libs/'
  ];

  const APLAYER_CSS = 'aplayer@1.10.1/dist/APlayer.min.css';
  const APLAYER_JS = 'aplayer@1.10.1/dist/APlayer.min.js';
  const METING_JS = 'meting@2.0.1/dist/Meting.min.js';

  
  function safeHasMusicPlayers() {
    try {
      return document.querySelectorAll('meting-js').length > 0;
    } catch (e) {
      console.warn('[Music Player] Error checking for music players:', e);
      return false;
    }
  }

  function safeResourcesLoaded() {
    try {
      return typeof window.APlayer !== 'undefined' && typeof window.Meting !== 'undefined';
    } catch (e) {
      console.warn('[Music Player] Error checking resources:', e);
      return false;
    }
  }

  
  function loadResource(url, resourceType, retries = 2) {
    return new Promise((resolve, reject) => {
      const isCSS = resourceType === 'css';
      const isJS = resourceType === 'js';

      
      const existing = isCSS
        ? document.querySelector(`link[href*="${url.split('/').pop()}"]`)
        : document.querySelector(`script[src*="${url.split('/').pop()}"]`);

      if (existing) {
        console.log(`[Music Player] Resource already loaded: ${url}`);
        resolve();
        return;
      }

      const element = isCSS ? document.createElement('link') : document.createElement('script');

      if (isCSS) {
        element.rel = 'stylesheet';
        element.href = url;
      } else {
        element.src = url;
      }

      let attempts = 0;

      const attemptLoad = () => {
        attempts++;

        element.onload = () => {
          console.log(`[Music Player] Successfully loaded: ${url}`);
          resolve();
        };

        element.onerror = (err) => {
          console.warn(`[Music Player] Failed to load ${url} (attempt ${attempts}/${retries + 1})`);

          if (attempts <= retries) {
            
            const nextCDN = CDN_SOURCES.find(cdn => url.startsWith(cdn));
            if (nextCDN) {
              const nextUrl = url.replace(nextCDN, CDN_SOURCES[(CDN_SOURCES.indexOf(nextCDN) + 1) % CDN_SOURCES.length]);
              console.log(`[Music Player] Retrying with alternative CDN: ${nextUrl}`);
              if (isCSS) {
                element.href = nextUrl;
              } else {
                element.src = nextUrl;
              }
              setTimeout(attemptLoad, 500);
            } else {
              reject(err);
            }
          } else {
            reject(err);
          }
        };

        
        if (isCSS) {
          document.head.appendChild(element);
        } else {
          document.body.appendChild(element);
        }
      };

      attemptLoad();
    });
  }

  
  function loadDependencies() {
    console.log('[Music Player] Loading dependencies with fallback support...');

    
    const primaryCDN = CDN_SOURCES[0];

    return loadResource(primaryCDN + APLAYER_CSS, 'css', 1)
      .then(() => {
        console.log('[Music Player] APlayer CSS loaded');
        return loadResource(primaryCDN + APLAYER_JS, 'js', 1);
      })
      .then(() => {
        console.log('[Music Player] APlayer JS loaded');
        return loadResource(primaryCDN + METING_JS, 'js', 1);
      })
      .then(() => {
        console.log('[Music Player] All dependencies loaded successfully');
        return true;
      })
      .catch(async (err) => {
        console.error('[Music Player] Primary CDN failed, trying alternative CDNs:', err);

        
        for (let i = 1; i < CDN_SOURCES.length; i++) {
          try {
            const cdn = CDN_SOURCES[i];
            console.log(`[Music Player] Trying CDN: ${cdn}`);

            await loadResource(cdn + APLAYER_CSS, 'css', 0);
            await loadResource(cdn + APLAYER_JS, 'js', 0);
            await loadResource(cdn + METING_JS, 'js', 0);

            console.log('[Music Player] Successfully loaded from alternative CDN');
            return true;
          } catch (altErr) {
            console.warn(`[Music Player] CDN ${CDN_SOURCES[i]} failed:`, altErr);
            continue;
          }
        }

        console.error('[Music Player] All CDN attempts failed');
        return false;
      });
  }

  
  function initializePlayers() {
    try {
      if (!safeResourcesLoaded()) {
        console.error('[Music Player] Cannot initialize: dependencies not loaded');
        return false;
      }

      console.log('[Music Player] Initializing meting-js players...');
      let successCount = 0;
      let errorCount = 0;

      const players = document.querySelectorAll('meting-js');

      players.forEach(el => {
        try {
          if (el.hasAttribute('data-initialized')) {
            console.log('[Music Player] Player already initialized, skipping');
            return;
          }

          
          if (typeof window.Meting !== 'function') {
            throw new Error('Meting constructor not available');
          }

          new window.Meting(el);
          el.setAttribute('data-initialized', 'true');
          successCount++;
          console.log('[Music Player] Successfully initialized meting-js element');
        } catch (err) {
          errorCount++;
          console.error('[Music Player] Error initializing meting-js element:', err);
        }
      });

      console.log(`[Music Player] Initialization complete: ${successCount} successful, ${errorCount} failed`);

      
      if (successCount === 0 && players.length > 0) {
        console.log('[Music Player] No players initialized, scheduling retry...');
        setTimeout(() => {
          console.log('[Music Player] Retrying initialization...');
          initializePlayers();
        }, 1000);
      }

      return successCount > 0;
    } catch (error) {
      console.error('[Music Player] Fatal error during initialization:', error);
      return false;
    }
  }

  
  function initMusicPlayers() {
    console.log('[Music Player] Initialization triggered');

    try {
      if (!safeHasMusicPlayers()) {
        console.log('[Music Player] No meting-js elements found');
        return;
      }

      const playerCount = document.querySelectorAll('meting-js').length;
      console.log(`[Music Player] Found ${playerCount} meting-js element(s)`);

      
      if (safeResourcesLoaded()) {
        console.log('[Music Player] Resources already loaded, initializing...');
        setTimeout(() => initializePlayers(), 50);
        return;
      }

      
      const scripts = Array.from(document.querySelectorAll('script[src]'));
      const hasAPlayerScript = scripts.some(s => s.src.includes('APlayer.min.js'));
      const hasMetingScript = scripts.some(s => s.src.includes('Meting.min.js'));

      if (hasAPlayerScript || hasMetingScript) {
        console.log('[Music Player] Resources detected in DOM, waiting for load...');
        waitForResources();
        return;
      }

      
      console.log('[Music Player] Loading dependencies dynamically...');
      loadDependencies().then(success => {
        if (success) {
          console.log('[Music Player] Dependencies loaded, initializing players...');
          setTimeout(() => initializePlayers(), 100);
        } else {
          console.error('[Music Player] Failed to load dependencies, will retry in 2s');
          setTimeout(initMusicPlayers, 2000);
        }
      });
    } catch (error) {
      console.error('[Music Player] Error in initialization flow:', error);
    }
  }

  
  function waitForResources() {
    const maxWaitTime = 10000; 
    const checkInterval = 250;
    let elapsed = 0;
    let timeoutId = null;

    const check = () => {
      elapsed += checkInterval;

      if (safeResourcesLoaded()) {
        console.log(`[Music Player] Resources loaded after ${elapsed}ms`);
        setTimeout(() => initializePlayers(), 50);
        return;
      }

      if (elapsed >= maxWaitTime) {
        console.warn('[Music Player] Timeout waiting for resources, loading dynamically...');
        loadDependencies().then(success => {
          if (success) {
            setTimeout(() => initializePlayers(), 100);
          }
        });
        return;
      }

      timeoutId = setTimeout(check, checkInterval);
    };

    check();
  }

  
  function startInitialization() {
    
    setTimeout(initMusicPlayers, 100);
  }

  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      console.log('[Music Player] DOMContentLoaded event fired');
      startInitialization();
    });
  } else {
    console.log('[Music Player] DOM already loaded');
    startInitialization();
  }

  
  if (typeof document.addEventListener === 'function') {
    document.addEventListener('pjax:end', function() {
      console.log('[Music Player] PJAX navigation detected');
      setTimeout(initMusicPlayers, 100);
    });
  }

  
  document.addEventListener('visibilitychange', function() {
    if (!document.hidden) {
      setTimeout(() => {
        if (document.querySelectorAll('meting-js').length > 0 && !safeResourcesLoaded()) {
          console.log('[Music Player] Page visible again, checking music players...');
          initMusicPlayers();
        }
      }, 500);
    }
  });

  
  window.initMusicPlayers = initMusicPlayers;
  console.log('[Music Player] Initialization system ready');
})();
</script>



    
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-line">
                <span id="run-time" data-i18n="runtime"></span>
            </div><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.122.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreferrer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div>

            <div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2024 - 2026</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/hzp2333/hzp2333.github.io" target="_blank">滑翔闪</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
            </div>

            <style>
                .footerImg {
                    height: 20px;
                }
            </style>
            <div class="footer-line custom">
                <a href="https://icp.gov.moe/?keyword=20244204" target="_blank">萌ICP备20244204号</a>
                <a style="text-decoration:none;color:#55bb8a;" href="https://travel.moe/go.html" title="异次元之旅-跃迁-我们一起去萌站成员的星球旅行吧！" target="_blank">
                    <img src="https://travel.moe/images/icon/icon64green.png" style="width:24px;height:24px" alt="异次元之旅">异次元之旅
                </a>
            </div>

            <div class="footer-line custom">
                <a href="https://www.travellings.cn/go.html" target="_blank">
                    <img src="https://www.travellings.cn/assets/logo.gif" class="footerImg" alt="开往-友链接力 v1.5" title="开往-友链接力 v1.5">
                </a>
                <a href="https://www.foreverblog.cn/" target="_blank">
                    <img src="https://foreverblog.cn/assets/logo/logo_en_default.png" class="footerImg" alt="Forever Blog">
                </a>
                <a href="https://www.foreverblog.cn/go.html" target="_blank">
                    <img src="https://foreverblog.cn/assets/logo/wormhole_2.gif" class="footerImg" alt="穿梭虫洞-随机访问十年之约友链博客" title="穿梭虫洞-随机访问十年之约友链博客">
                </a>
            </div><div class="footer-line">
  <i class="fas fa-book fa-fw" aria-hidden="true"></i>&nbsp;56 posts, 88641 words total</div>
    
        
        <script async src=" //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js "></script>
    

    
        
            <section>
                
                    <span id="busuanzi_container_value_site_pv"><i class="far fa-eye fa-fw"></i>
                        
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                

                
                    &nbsp;|&nbsp;              
                

                
                    <span id="busuanzi_container_value_site_uv"><i class="fa fa-user"></i>
                        
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
            </section>
        

        
        
    


</div>
    </footer>
 

    
    <script src="https://cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js" 
        data-color="0,0,0" 
        data-count="150" 
        data-zIndex="-1">
    </script>
</body>
</html>



</div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{"giscus":{"category":"Announcements","categoryId":"DIC_kwDOLbBjxM4Cdr0n","darkTheme":"dark_dimmed","emitMetadata":"0","inputPosition":"bottom","lang":"en","lazyLoading":false,"lightTheme":"light","mapping":"pathname","reactionsEnabled":"1","repo":"hzp2333/Giscus","repoId":"R_kgDOLbBjxA"}},"data":{"id-1":"HXS'S BLOG","id-2":"HXS'S BLOG"},"lightgallery":true,"search":{"highlightTag":"em","lunrIndexURL":"/en/index.json","lunrLanguageCode":"en","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script><script type="text/javascript" src="/js/custom.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-CYZVM6VVZ8', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-CYZVM6VVZ8" async></script></body>
</html>
